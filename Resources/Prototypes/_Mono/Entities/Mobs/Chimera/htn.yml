# SPDX-FileCopyrightText: 2025 starch
#
# SPDX-License-Identifier: AGPL-3.0-or-later

# Its really annoying how far i have to go in HTN yaml to make a AI that doesnt get stuck trying to pickup a folding chair like a dumbass.

- type: entity
  id: MobHumanoidHostileAIChimera
  abstract: true
  components:
  - type: HTN
    rootTask:
      task: ChimeraHostileCompound
    blackboard:
      NavClimb: !type:Bool
        true
      NavInteract: !type:Bool
        true
      NavPry: !type:Bool
        true
      NavSmash: !type:Bool
        true

- type: htnCompound
  id: ChimeraHostileCompound
  branches:
  - tasks:
    - !type:HTNCompoundTask
      task: MeleeCombatCompoundNoGrabWeapon
  - tasks:
    - !type:HTNCompoundTask
      task: IdleCompound

- type: htnCompound
  id: MeleeCombatCompoundNoGrabWeapon
  branches:
  - tasks:
    - !type:HTNPrimitiveTask
      operator: !type:UtilityOperator
        proto: NearbyMeleeTargets
    - !type:HTNCompoundTask
      task: BeforeMeleeAttackTargetCompoundNoGrabWeapon

- type: htnCompound
  id: BeforeMeleeAttackTargetCompoundNoGrabWeapon
  branches:
  - preconditions:
    - !type:BuckledPrecondition
      isBuckled: true
    tasks:
    - !type:HTNPrimitiveTask
      operator: !type:UnbuckleOperator
        shutdownState: TaskFinished
  - preconditions:
    - !type:PulledPrecondition
      isPulled: true
    tasks:
    - !type:HTNPrimitiveTask
      operator: !type:UnPullOperator
        shutdownState: TaskFinished
  - preconditions:
    - !type:InContainerPrecondition
      isInContainer: true
    tasks:
    - !type:HTNCompoundTask
      task: EscapeCompound
  - tasks:
    - !type:HTNCompoundTask
      task: MeleeAttackTargetCompound
