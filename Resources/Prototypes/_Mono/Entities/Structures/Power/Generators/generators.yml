# SPDX-FileCopyrightText: 2025 starch
#
# SPDX-License-Identifier: MPL-2.0

- type: entity
  abstract: true
  id: StaticGeneratorBase
  parent: [ BaseStructure ]
  components:
  # Basic properties
  - type: Animateable
  - type: InteractionOutline
  - type: Transform
    anchored: False
  - type: Anchorable
    delay: 30
  - type: Physics
    bodyType: Dynamic
  - type: StaticPrice
    price: 500
  - type: AmbientSound
    range: 5
    volume: -5
    sound:
      path: /Audio/Ambience/Objects/engine_hum.ogg
    enabled: false
  - type: Fixtures
    fixtures:
      fix1:
        shape:
          !type:PhysShapeAabb
          bounds: "-0.40,-0.40,0.40,0.40"
        density: 155
        mask:
        - MachineMask
        layer:
        - MachineLayer

  # Visuals
  - type: Appearance
  - type: Sprite
    sprite: Structures/Power/Generation/portable_generator.rsi
    noRot: true

  # Construction, interaction
  - type: UserInterface
    interfaces:
      enum.GeneratorComponentUiKey.Key:
        type: PortableGeneratorBoundUserInterface
  - type: ActivatableUI
    key: enum.GeneratorComponentUiKey.Key
  - type: Electrified
    onHandInteract: false
    onInteractUsing: false
    onBump: false
    requirePower: true
    highVoltageNode: output

  - type: Destructible
    thresholds:
    - trigger:
        !type:DamageTrigger
        damage: 2000
      behaviors:
      - !type:DoActsBehavior
        acts: [ "Destruction" ]
    - trigger:
        !type:DamageTrigger
        damage: 1000
      behaviors:
      - !type:PlaySoundBehavior
        sound:
          collection: MetalBreak
      - !type:DoActsBehavior
        acts: ["Destruction"]
  - type: GuideHelp
    guides:
    - PortableGenerator
    - Power

  # Core functionality
  - type: PortableGenerator
    startSoundEmpty: { collection: GeneratorTugEmpty }
    startSound: { collection: GeneratorTug }
  - type: FuelGenerator
  - type: PowerSupplier
    supplyRate: 3000
    supplyRampRate: 500
    supplyRampTolerance: 500
    enabled: false
  - type: ThermalSignature
  - type: DeviceLinkSink
    ports:
    - On
    - Off
    - Toggle
  - type: GeneratorSignalControl
  - type: PowerMonitoringDevice
    group: Generator
    loadNodes:
    - output_hv
    - output_mv
  - type: DeviceNetwork
    deviceNetId: Wireless
    receiveFrequencyId: BasicDevice
  - type: GeneratorExhaustGas
    gasType: CarbonDioxide
    # 0.5 moles of gas for every sheet of plasma.
    moleRatio: 0.5
  - type: WirelessNetworkConnection
    range: 200
  - type: LanguageSpeaker
  - type: LanguageKnowledge
    speaks:
    - TauCetiBasic
    understands:
    - TauCetiBasic
  - type: Climbable
  - type: FootstepModifier
    footstepSoundCollection:
      collection: FootstepHull
  - type: StationAiWhitelist
  - type: LightningTarget
    priority: 1
  # switchy doohickey
  - type: PowerSwitchable
    examineText: power-switchable-generator-examine
    switchText: power-switchable-generator-switched
    cables:
    - voltage: HV
      node: output_hv
    - voltage: MV
      node: output_mv
  - type: UseDelay
    delay: 1
  - type: NodeContainer
    examinable: true
    nodes:
      output_hv:
        !type:CableDeviceNode
        nodeGroupID: HVPower
      output_mv:
        !type:CableDeviceNode
        nodeGroupID: MVPower
        enabled: false

- type: entity
  name: SKR CR-class Z-pinch nuclear fusion reactor
  description: |-
    Industrial fuel-grade plasma burning miniature fusion reactor. Highly efficient
    Ideal power production is 105 kW. Minimum and maximum power production is 60 and 160 kW.
    Highly radioactive without protection due to the light Iridite frame of the reactor.
  parent:
  - StaticGeneratorBase
  id: GeneratorCRPinch
  suffix: Plasma, Rad+, 105 kW
  placement:
    mode: AlignTileAny
  components:
  - type: Sprite
    sprite: _Mono/Structures/Power/Generators/pinchreactor.rsi
    offset: 0,-0.5
    noRot: false
    layers:
    - state: portgen0
      map: [ "enum.GeneratorVisualLayers.Body" ]
  - type: Transform
    anchored: true
  - type: Physics
    bodyType: Static
  - type: GenericVisualizer
    visuals:
      enum.GeneratorVisuals.Running:
        enum.GeneratorVisualLayers.Body:
          True: { state: portgen0on }
          False: { state: portgen0 }
  - type: FuelGenerator
    minTargetPower: 50000
    maxTargetPower: 160000
    targetPower: 105000
    optimalPower: 105000
    optimalBurnRate: 0.001
    fuelEfficiencyConstant: 0.95
    radiationColor: "#662040"
  - type: SolidFuelGeneratorAdapter
    fuelMaterial: FuelGradePlasma
    multiplier: 0.01
  - type: MaterialStorage
    materialWhiteList: [Plasma, FuelGradePlasma]
  - type: PowerMonitoringDevice
    sprite: _Mono/Structures/Power/Generators/pinchreactor.rsi
    state: portgen0
  - type: Fixtures
    fixtures:
      fix1:
        shape:
          !type:PhysShapeAabb
          bounds: "-0.45,-1.4,0.45,0.45"
        density: 1200
        mask:
        - MachineMask
        layer:
        - MachineLayer
  - type: RadiationSource
    enabled: false
  - type: AmbientSound
    volume: 1
    enabled: false
    sound:
      path: /Audio/Ambience/Objects/engine_hum.ogg
  - type: PowerSupplier
    supplyRampRate: 10000
    supplyRampTolerance: 3000
  - type: FuelGradeAdapter
    inputMaterial: Plasma
    outputMaterial: FuelGradePlasma

- type: entity
  parent:
  - BaseGeneratorShuttle
  - GeneratorCRPinch
  id: GeneratorCRPinchShuttle
  suffix: Plasma, Rad+, 105 kW, Ship
  components:
  - type: MaterialStorage
    storage:
      FuelGradePlasma: 2500
