# SPDX-FileCopyrightText: 2025 starch
#
# SPDX-License-Identifier: AGPL-3.0-or-later

- type: entity
  id: DesertStone
  name: rock
  parent: BaseItem
  description: Its a stone.
  components:
  - type: Sprite
    sprite: _Mono/Objects/Misc/desert_stone.rsi
    state: icon
  - type: Item
    size: Small
  - type: Tag
    tags:
    - RockMaterial
  - type: MeleeWeapon
    heavyStaminaCost: 5
    wideAnimationRotation: -35
    damage:
      types:
        Blunt: 15
    soundHit:
      collection: MetalThud
  - type: DamageOtherOnHit
    damage:
      types:
        Blunt: 5

- type: entity
  id: DesertSand
  name: sand
  parent: BaseItem
  description: Its just some sand.
  suffix: Full
  components:
  - type: Sprite
    sprite: _Mono/Objects/Misc/desert_sand.rsi
    state: icon
  - type: Stack
    stackType: DesertSand
    count: 250
  - type: Item
    size: Tiny
  - type: Tag
    tags:
    - SandMaterial

- type: entity
  parent: DesertSand
  id: DesertSand1
  suffix: 1
  components:
  - type: Stack
    count: 1

- type: entity
  parent: DesertSand
  id: DesertSand50
  suffix: 50
  components:
  - type: Stack
    count: 50

- type: entity
  parent: FloraRockSolid
  id: FloraRockSolidPlanet
  suffix: planet
  components:
  - type: Destructible
    thresholds:
    - trigger:
        !type:DamageTrigger
        damage: 25
      behaviors:
      - !type:PlaySoundBehavior
        sound:
          path: /Audio/Effects/break_stone.ogg
          params:
            volume: -6
      - !type:DoActsBehavior
        acts: [ "Destruction" ]
      - !type:SpawnEntitiesBehavior
        spawn:
          DesertStone:
            min: 2
            max: 5

- type: entity
  name: sand
  id: hydroponicsSand
  parent: hydroponicsSoil
  placement:
    mode: SnapgridCenter
  components:
  - type: Sprite
    sprite: Structures/Hydroponics/misc.rsi
    state: sand
    noRot: true
  - type: Construction
    graph: SandGraph
    node: SandNode

- type: construction
  id: Sand
  name: sand pile
  description: Somehow works as a growing spot.
  graph: SandGraph
  startNode: start
  targetNode: SandNode
  category: construction-category-furniture
  icon:
    sprite: Structures/Hydroponics/misc.rsi
    state: sand
  objectType: Structure
  placementMode: SnapgridCenter
  canBuildInImpassable: false
  conditions:
  - !type:TileNotBlocked

- type: constructionGraph
  id: SandGraph
  start: start
  graph:
  - node: start
    actions:
    - !type:DestroyEntity {}
    edges:
    - to: SandNode
      completed:
      - !type:SnapToGrid { }
      steps:
      - tag: SandMaterial
        name: desert sand
        icon:
          sprite: _Mono/Objects/Misc/desert_sand.rsi
          state: icon
        doAfter: 6

  - node: SandNode
    entity: hydroponicsSand
    edges:
    - to: start
      steps:
      - tool: Prying # you may think digging would be better, but digging would just remove the plant lol
        doAfter: 1
